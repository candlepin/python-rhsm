#
# Copyright (c) 2012 Red Hat, Inc.
#
# This software is licensed to you under the GNU General Public License,
# version 2 (GPLv2). There is NO WARRANTY for this software, express or
# implied, including the implied warranties of MERCHANTABILITY or FITNESS
# FOR A PARTICULAR PURPOSE. You should have received a copy of GPLv2
# along with this software; if not, see
# http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.
#
# Red Hat trademarks are not licensed under GPLv2. No permission is
# granted to use or replicate Red Hat trademarks that are incorporated
# in this software or its documentation.
#

import unittest

from rhsm.certificate2 import *


# A product cert from Candlepin's test data (product ID 100000000000002):
PRODUCT_CERT_V1_0 = """
-----BEGIN CERTIFICATE-----
MIIDeDCCAuGgAwIBAgIECgf/jTANBgkqhkiG9w0BAQUFADAzMRIwEAYDVQQDDAls
b2NhbGhvc3QxCzAJBgNVBAYTAlVTMRAwDgYDVQQHDAdSYWxlaWdoMB4XDTExMDgy
MzE3NDEzOVoXDTIxMDgyMzE3NDEzOVowGjEYMBYGA1UEAxMPMTAwMDAwMDAwMDAw
MDAyMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAkbvsjJXu+vRzbBa+
G9S77gbQTtSbZXWncykJkinwqQkUl2jEnGN+BBYa30dfLFatkA6UP4XICIu+xVMw
qXc2O82BBubYvBTcqJy62U1YQnJFz/upSF0b9mKhcwJv2sAqMfkviGTYpjuCTfw6
VVSFUvIj+K16vRzZWgn+qTIUIt8yXipuz7E/4t+R2BG/9GCqjQq7LQb4y0FmWdGT
OehTjEY+G4+evsjyom5hXLgXlMhd3vkb7gHOyc3Yuk9h9eqGKg0oCiaF88KafMcu
hCp0mIC7W97jE2tHTWzfERw99j+uPjccBUljqVpNfW6S/iKDx0tkzv0pOnSxYYmd
HF5rbQIDAQABo4IBLDCCASgwEQYJYIZIAYb4QgEBBAQDAgWgMAsGA1UdDwQEAwIE
sDBjBgNVHSMEXDBagBQckL9Tc4HS6Df/ppG4uN7zSUsnD6E3pDUwMzESMBAGA1UE
AwwJbG9jYWxob3N0MQswCQYDVQQGEwJVUzEQMA4GA1UEBwwHUmFsZWlnaIIJAPrR
0C/V93lLMB0GA1UdDgQWBBQPunbOh02rAFia+TmNDHCa05vI/DATBgNVHSUEDDAK
BggrBgEFBQcDAjAxBhErBgEEAZIICQGW3rGD6YACAQQcDBpBd2Vzb21lIE9TIGZv
ciB4ODZfNjQgQml0czAdBhErBgEEAZIICQGW3rGD6YACAwQIDAZ4ODZfNjQwGwYR
KwYBBAGSCAkBlt6xg+mAAgIEBgwEMy4xMTANBgkqhkiG9w0BAQUFAAOBgQARCW1E
d/w1WYaQElsYAN9/EyDXyXq4GJfTFES8eg09nUKYrMACds2wdh8m8vV7NtHl8E0y
wE//vrTlHGSD5m4/mcXsgpkHvbj/kOTP7aag7RPa51M8ocjtOplugUyIF0PsXO4B
SOxSnd1U0dX6pzEwMaJD9lCW8xZ2jsmdLUtLzQ==
-----END CERTIFICATE-----
"""

# Test entitlement to the product cert above:
ENTITLEMENT_CERT_V1_0 = """
-----BEGIN CERTIFICATE-----
MIIJSzCCCLSgAwIBAgIICT4q81yqebkwDQYJKoZIhvcNAQEFBQAwNjEVMBMGA1UE
AwwMMTkyLjE2OC4xLjI1MQswCQYDVQQGEwJVUzEQMA4GA1UEBwwHUmFsZWlnaDAe
Fw0xMjA3MDUwMDAwMDBaFw0xMzA3MDUwMDAwMDBaMCsxKTAnBgNVBAMTIGZmODA4
MDgxMzg1NzRiZDIwMTM4NTc0ZDg1YTUwYjJmMIIBIjANBgkqhkiG9w0BAQEFAAOC
AQ8AMIIBCgKCAQEAlUV2otyTyQbhSV77Od1qoZMwr2Xz1gvgQUN5/0b7HREutMCT
4okqvDkYkt50pu76M0CatAK89A716plMjzcFyyWvUuR9adxzD6VXTSxORabL1hto
30a6hERNdwt7ma43ezvouY0tvjQ8MDFMQb2MC5yhKAq3H1mdZEtDdjlU7MQ1ujX3
wK2We0HW4sMkZXM/ZtiqXU5vB9h5hVFeZo4E7d+HayopsQoB5cKMu9MAGCg75rdD
i3pO/9za1q2fQsUjnzImMPBCVfpN2K7CuI7098MxDyjvNrU/Vql6rYhDbdGOJTWD
GZf40j/j/T+CReEMZsKHNRgLtMK+dcg4GuD+DQIDAQABo4IG5zCCBuMwEQYJYIZI
AYb4QgEBBAQDAgWgMAsGA1UdDwQEAwIEsDBmBgNVHSMEXzBdgBREQHYTNskB3AHY
/8EcmROo5jrOoqE6pDgwNjEVMBMGA1UEAwwMMTkyLjE2OC4xLjI1MQswCQYDVQQG
EwJVUzEQMA4GA1UEBwwHUmFsZWlnaIIJAPMeoqmMwB3XMB0GA1UdDgQWBBSsreit
gWXwXzIMZ3JIMdUOEkylIDATBgNVHSUEDDAKBggrBgEFBQcDAjAxBhErBgEEAZII
CQGW3rGD6YACAQQcDBpBd2Vzb21lIE9TIGZvciB4ODZfNjQgQml0czAdBhErBgEE
AZIICQGW3rGD6YACAwQIDAZ4ODZfNjQwGwYRKwYBBAGSCAkBlt6xg+mAAgIEBgwE
My4xMTAUBgsrBgEEAZIICQIBAQQFDAN5dW0wKAYMKwYBBAGSCAkCAQEBBBgMFmFs
d2F5cy1lbmFibGVkLWNvbnRlbnQwKAYMKwYBBAGSCAkCAQECBBgMFmFsd2F5cy1l
bmFibGVkLWNvbnRlbnQwHQYMKwYBBAGSCAkCAQEFBA0MC3Rlc3QtdmVuZG9yMC4G
DCsGAQQBkggJAgEBBgQeDBwvZm9vL3BhdGgvYWx3YXlzLyRyZWxlYXNldmVyMCYG
DCsGAQQBkggJAgEBBwQWDBQvZm9vL3BhdGgvYWx3YXlzL2dwZzATBgwrBgEEAZII
CQIBAQgEAwwBMTAVBgwrBgEEAZIICQIBAQkEBQwDMjAwMBUGDCsGAQQBkggJAtZ0
AQQFDAN5dW0wIwYNKwYBBAGSCAkC1nQBAQQSDBBhd2Vzb21lb3MteDg2XzY0MCMG
DSsGAQQBkggJAtZ0AQIEEgwQYXdlc29tZW9zLXg4Nl82NDAaBg0rBgEEAZIICQLW
dAEFBAkMB1JlZCBIYXQwLAYNKwYBBAGSCAkC1nQBBgQbDBkvcGF0aC90by9hd2Vz
b21lb3MveDg2XzY0MCoGDSsGAQQBkggJAtZ0AQcEGQwXL3BhdGgvdG8vYXdlc29t
ZW9zL2dwZy8wFAYNKwYBBAGSCAkC1nQBCAQDDAEwMBcGDSsGAQQBkggJAtZ0AQkE
BgwEMzYwMDAUBgsrBgEEAZIICQIAAQQFDAN5dW0wJwYMKwYBBAGSCAkCAAEBBBcM
FW5ldmVyLWVuYWJsZWQtY29udGVudDAnBgwrBgEEAZIICQIAAQIEFwwVbmV2ZXIt
ZW5hYmxlZC1jb250ZW50MB0GDCsGAQQBkggJAgABBQQNDAt0ZXN0LXZlbmRvcjAh
BgwrBgEEAZIICQIAAQYEEQwPL2Zvby9wYXRoL25ldmVyMCUGDCsGAQQBkggJAgAB
BwQVDBMvZm9vL3BhdGgvbmV2ZXIvZ3BnMBMGDCsGAQQBkggJAgABCAQDDAEwMBUG
DCsGAQQBkggJAgABCQQFDAM2MDAwFQYMKwYBBAGSCAkC1mkBBAUMA3l1bTAcBg0r
BgEEAZIICQLWaQEBBAsMCWF3ZXNvbWVvczAcBg0rBgEEAZIICQLWaQECBAsMCWF3
ZXNvbWVvczAaBg0rBgEEAZIICQLWaQEFBAkMB1JlZCBIYXQwOwYNKwYBBAGSCAkC
1mkBBgQqDCgvcGF0aC90by8kYmFzZWFyY2gvJHJlbGVhc2V2ZXIvYXdlc29tZW9z
MCoGDSsGAQQBkggJAtZpAQcEGQwXL3BhdGgvdG8vYXdlc29tZW9zL2dwZy8wFAYN
KwYBBAGSCAkC1mkBCAQDDAExMBcGDSsGAQQBkggJAtZpAQkEBgwEMzYwMDAlBgor
BgEEAZIICQQBBBcMFUF3ZXNvbWUgT1MgZm9yIHg4Nl82NDAwBgorBgEEAZIICQQC
BCIMIGZmODA4MDgxMzg1NzRiZDIwMTM4NTc0YzdmMWYwMjNjMCAGCisGAQQBkggJ
BAMEEgwQYXdlc29tZW9zLXg4Nl82NDARBgorBgEEAZIICQQFBAMMATUwEQYKKwYB
BAGSCAkECQQDDAExMCQGCisGAQQBkggJBAYEFgwUMjAxMi0wNy0wNVQwMDowMDow
MFowJAYKKwYBBAGSCAkEBwQWDBQyMDEzLTA3LTA1VDAwOjAwOjAwWjASBgorBgEE
AZIICQQMBAQMAjMwMBIGCisGAQQBkggJBAoEBAwCNjYwGwYKKwYBBAGSCAkEDQQN
DAsxMjMzMTEzMTIzMTARBgorBgEEAZIICQQOBAMMATAwEQYKKwYBBAGSCAkEEQQD
DAExMBEGCisGAQQBkggJBAsEAwwBMjA0BgorBgEEAZIICQUBBCYMJDQwOTJlYzcz
LTE5MGUtNGY0Ny1iMmEzLWUxZTg4OWVkOGE5ODANBgkqhkiG9w0BAQUFAAOBgQA4
BLbyoRumbzf3/UXZfzkQbUPeN1CYBP64soVdIe8Wp0Dp3H6ZF8CFR6+w1R3Q7asL
Ej4AxyURBnHhQCz5UleHnMBdLU9BK2Z0BTHCrkke8tDFxsIQ2oz2Ny/+gqegyJS/
AOY8AMtVsQ9LuANGqNf42hcpFsAWy5kboT+gIXFxmw==
-----END CERTIFICATE-----
"""

ENTITLEMENT_CERT_V2_0 = """
-----BEGIN CERTIFICATE-----
MIIF5zCCBVCgAwIBAgIIRI2ZmiQd6qkwDQYJKoZIhvcNAQEFBQAwNjEVMBMGA1UE
AwwMMTkyLjE2OC4xLjI1MQswCQYDVQQGEwJVUzEQMA4GA1UEBwwHUmFsZWlnaDAe
Fw0xMjA3MTMwMDAwMDBaFw0xMzA3MTMwMDAwMDBaMCsxKTAnBgNVBAMTIGZmODA4
MDgxMzg4MDQ4ZWEwMTM4ODA0ZGI4M2UwYTY2MIIBIjANBgkqhkiG9w0BAQEFAAOC
AQ8AMIIBCgKCAQEAuakjd2Q0TYsvUlecSgLRTyin+e6ZkYPrWZEXyP1B+zYs8q/E
Gz7L+gS5T1YOUcQv5GdQ8+S5StMiuhzpiNZQWkT15nbubg6458C75M1Y18huW7HA
1E/UzKjbrrHJ0GQSUGEL6Iqg86IcyhOqp/niz3AgZludRboFa+6ffg/eGzMMAKlV
zmURiz6JT4K4apm1hKR52FC6UuE4QwLzpk1aDNoX8KUlGdvs8ZZeL7tKyMxL5PCq
axwJvqcgWUKoe1+Dd5EmQi7uw8xMHuHsHc3AtFBe1OJ2/MrbD1nEYfQrFo6iU/zb
m3usMy85zjQIbXhKzfWlJCUHPrZdJAVSuGdUFwIDAQABo4IDgzCCA38wEQYJYIZI
AYb4QgEBBAQDAgWgMAsGA1UdDwQEAwIEsDBmBgNVHSMEXzBdgBREQHYTNskB3AHY
/8EcmROo5jrOoqE6pDgwNjEVMBMGA1UEAwwMMTkyLjE2OC4xLjI1MQswCQYDVQQG
EwJVUzEQMA4GA1UEBwwHUmFsZWlnaIIJAPMeoqmMwB3XMB0GA1UdDgQWBBQPBYVN
0869QNCXniSF4OUhJzxmFDATBgNVHSUEDDAKBggrBgEFBQcDAjCCAqsGCSsGAQQB
kggJBwSCApwMggKYZUp5ZFZORnVtekFVL1JWazlURU1HNmRBZVd1ZjlqWnAyOU9t
S2pMbWtxS0F6V3pUTktyeTc3dUdGTkdHWnRFQUNjTzl2dWVjZTJ5L0VtMUtNQ1Iv
SlZJclo0UjBKQ2RKU2xiRU9tSDhSMHhaSE5JMFpQd25wZm53L01Ld2tGTDN5aWV3
bUhQR09MNFkvdi9UQytWcWR5QTVveXVpK3JidzVVbFZaUlJ2eHJPTXJqTVFkQnpk
WmJLOG95eGQ0MHhRNVFqSHorQ09TS2N2ckRSMTUycXRQRjJyNVE2Y1JaaUJxdHpW
YXJ1cGZRWFBRb2tXY0hpL0I2dGJDTDc5Q0NwdGdwY3MyU1FleXU1NmpJb3hxbTA0
QmZiQ0tDeEVjazZQY3kzeHl2Zkg5dTBncHVEOGxoZEpFZEtLWitHNmpOZGhrVUla
U2trVFRsTk9iMlBmd2M3b3NwZWU0Kyt4dmVEN2hlT0paZ3RPbE1LSkRieDB0VUhH
TWNXbVBXTW50TWR4WUYxNCtwbzBpV1l2RGpZRUpZckdZNTdxSXB4d1R4aVBLcTBq
UDQ3R3pPakdRQVBDd2pQNEt0dHV1K2xOczVTSUlVeG9SQUhOSlJ4MzZEeVBROStp
TDI5aUdJdEhENGRza2xlaXNiQWdrQ2Z2Rkg2SE12Z3EzRXpkdVNkdnVnYXFUa2RU
U2pTbHpFU2RaMkV3bXVzNlIxaFNSSzlSay96Ykx1WDdmbzFiNm9KQlEreURQNThW
L3NRZXhwZlcyOVYyTFBod1UrQ2lFa1krelZkWU5KL3hYN1o4a1BDNE9rbWc4eXYy
SnhCQzF3Nms2dzM0UFVaT2ZqNWUzdjdCUSswOENKSzF3MWxDK0JmR0VPajRGNXRT
bU1BPTASBgkrBgEEAZIICQYEBQwDMi4wMA0GCSqGSIb3DQEBBQUAA4GBAF83PUVg
4EigVhIi26nA+M19+cy8QFJAdKLDgeT37jRATodz03NnuCOLDPtleVo+u2HXOUlt
aBkRfQdtWKyEPwIGwXLCvK/eBIrq8irtRllsDP1faANDM/3u4gjZCQWQqPjHgVku
L3HH0boJv8rE8BEJgcJFb9dPtvQ7CVWJnXVC
-----END CERTIFICATE-----
"""

# At one point this cert failed to parse due to header length:
ENTITLEMENT_CERT_V2_0_LONG_BLOB = """
-----BEGIN CERTIFICATE-----
MIIGgzCCBeygAwIBAgIIDFOYEsAlgt0wDQYJKoZIhvcNAQEFBQAwNjEVMBMGA1UE
AwwMMTkyLjE2OC4xLjI1MQswCQYDVQQGEwJVUzEQMA4GA1UEBwwHUmFsZWlnaDAe
Fw0xMjA3MTYwMDAwMDBaFw0xMzA3MTYwMDAwMDBaMCsxKTAnBgNVBAMTIGZmODA4
MDgxMzg5MTM2MmMwMTM4OTE2YTRiYmUwMDEzMIIBIjANBgkqhkiG9w0BAQEFAAOC
AQ8AMIIBCgKCAQEAghXR3hzHx96ceHyRvZAi2wVbMdBNLHZhwuF3HPgxMs3OHr2K
YjKaStkg0qioPKu02WkDk6aCJT7+3BiLD7CKnZ98nqMXh2wErq6JQCnMeplDsbON
3It2QVifxtOLZ18fUtU1RtdfPP9PyBgQOQs5et67AniFY1nglN/rpQRpl+PKSZrM
Oh0Im4lxblNFcccaXQ5PhLVFGc/QL65ukKdjKnQdi8AFWz81J3JgsciM5gfc7G31
kqTl7wgSGgDH10rbffKXx1gpE7F1Su/vZa+oKxZnZyHFPsfasJ2jUOFZmQ50k1eU
ZqcoFTTYIPdBUP1GfKRqLFY9NpKbpFoVV5xXkQIDAQABo4IEHzCCBBswEQYJYIZI
AYb4QgEBBAQDAgWgMAsGA1UdDwQEAwIEsDBmBgNVHSMEXzBdgBREQHYTNskB3AHY
/8EcmROo5jrOoqE6pDgwNjEVMBMGA1UEAwwMMTkyLjE2OC4xLjI1MQswCQYDVQQG
EwJVUzEQMA4GA1UEBwwHUmFsZWlnaIIJAPMeoqmMwB3XMB0GA1UdDgQWBBS2WJuf
1Xj1rSzXUqok1SnWAwtW9DATBgNVHSUEDDAKBggrBgEFBQcDAjCCA0cGCSsGAQQB
kggJBwSCAzgMggM0ZUp5dGx0MlBvakFRd1A4VjAreWpIQzFWQk4vdW52YnRrcnQ3
dW9zeHBSUWxDNVJ0eTZyWitML2ZsQSsvRmx6anFpS0Z6blRtTnpNZGVFZFN4VUto
K1R2aXNqQ0tjWVBtS0p5aE1kS0dLWHZoWWVJNWVPWVEvdy9HOC9yM0Y2WVo1N0lx
ckFEeEtDV0V3b25BL2RlS0ZTWTFPelFuZUl5S0tvL3M4aWhKQWd4ZlFvTVFod0pI
dUIzeFdlSmhpcWVnS1lxNE1VYy9tTnVETzFXa3VVcExrOHJDdXFzbGZ4RkdneGtm
ekxCY2dPNzNqZEF5RjZPZnYwZUpWS050NEMvOWladjZnZSttREVabHllMEJJMDFE
dkszL0xlbExCY3FzVVpiYUVXOUM3Y3c2TFZZd3VXR3FzS001eGZzenVyR05tSzd5
R3M5aklRbmpnRGc4eHI0em1Vd1RKNXo1TXdkekpqek9KbDZNUTFpc1ZES3V1UFg2
WHhOd1lTTUk0OVNpRTBJOHZ3NEVpeklCZHhLV2FURkd1VEFzWm9ZdHhiWk1GWUJT
SDBOczN5QmcwaHIvSmVMUk16UG9FSWNqU2sxckRUT3poZ25YbmwwajNZT0UyMG1z
eXRXeVVsbS9FRXk2SUpPeFNHUzk2NXRkYVEzdnFoeHlkWUpESG90VHArMHFUaWR4
SDA2blBZUXpmU3lPTGNxck5LM0FmVEN0Y2k4TDZ2SGJPM1BiQ0cyYzl1cm9lclpo
TzlnZ1RRaWNyb0tQQ0ltVWpZdU5wUHVrUkNhWXRqdnFuT05TRUtaT0lZYnNEQ1dH
UGpneDBES3VKNllSdURNeGpmSVF5K1N4TEUwWHZFcHpFTG1QNTZEZVI0UnZvZkUv
TDczQzF0QXRsVmRjS2JaNjdxTFdoaFllU2svdzhBNzlXWC8rU25jZUJpRzByd25j
N0hpUDAwOFI3SFNtK1BwMDI3dW5HbmRoWENBc3hpMENQdmtRMjlHczZkUUliaW9s
N0NNV0hRcXozWEZkdjIxQzNqNjZ1cDVmdnd3c3Z2UXVNZnFSR3VzdVlPdjZOUVhS
YitEWmZySC9EeWJnL2pzPTASBgkrBgEEAZIICQYEBQwDMi4wMA0GCSqGSIb3DQEB
BQUAA4GBAJHm4ShJiIbG234Z5m0sJ2LY8M6Xrs8t2tnz7bClpd9+oMKl5t6HgQAf
JtS3cbsiUhDYqWprrpuG8sq9Cg9mO8dU2TgUVQkF1KInLr+JGhTlAZkkMfaKn/6g
u79SxF0zp0gfXHKi2iz/t16Xaq//vVhyF0BrlmUJHGDlAe5nNNHR
-----END CERTIFICATE-----
"""



IDENTITY_CERT = """
-----BEGIN CERTIFICATE-----
MIIDVTCCAr6gAwIBAgIISxupxU7CJJkwDQYJKoZIhvcNAQEFBQAwNjEVMBMGA1UE
AwwMMTkyLjE2OC4xLjI1MQswCQYDVQQGEwJVUzEQMA4GA1UEBwwHUmFsZWlnaDAe
Fw0xMjA3MTAxMjIxMjdaFw0yODA3MTAxMjIxMjdaMC8xLTArBgNVBAMTJGVhYWRk
NmVhLTg1MmQtNDQzMC05NGE3LTczZDU4ODdkNDhlODCCASIwDQYJKoZIhvcNAQEB
BQADggEPADCCAQoCggEBAIwkCSdEYYRBD6uHC20Wh3491i4OfkQKtufOkBiMw6Rv
90tqsiolC4bGgRk1vwgSfyaeTITu92tnRM2mxbZ/xzbV7B+r/LW5DLnAUufZWwpF
B/Bpv2+hJAZh927MaxaYWhtMuX7rxiz77TpVtxhEnC1M8xj0/3dqOEOABD5x3yVs
KQBA+3eDu/ocptyoHxoEsR9RYdmdAxxIKm29NtlqG+lXoHDqjckXiPxFWDLLjFnF
T7oE6zoZQ+5aBgoOu5bTpHW4jQc7ddKOo33NUF1x9lTQKG4How8XkMdy4/EjeaE9
fWa1dSahgDyMeKNZkW0PI9OPOVsV7Yg7oaBEjCX0FDsCAwEAAaOB7jCB6zARBglg
hkgBhvhCAQEEBAMCBaAwCwYDVR0PBAQDAgSwMGYGA1UdIwRfMF2AFERAdhM2yQHc
Adj/wRyZE6jmOs6ioTqkODA2MRUwEwYDVQQDDAwxOTIuMTY4LjEuMjUxCzAJBgNV
BAYTAlVTMRAwDgYDVQQHDAdSYWxlaWdoggkA8x6iqYzAHdcwHQYDVR0OBBYEFLO4
v3v+LWsotuGi0n1kxcQ7L7YkMBMGA1UdJQQMMAoGCCsGAQUFBwMCMC0GA1UdEQQm
MCSkIjAgMR4wHAYDVQQDDBVyZWRoYXQubG9jYWwucm0tcmYuY2EwDQYJKoZIhvcN
AQEFBQADgYEAfQgG0q88GELGHLhk3HI3Ygnqy7XqccSF4WWC1YsxQMpT2QLwAcAK
X6IYCJfN6Y6ywZDD0o+ISr2gpEh24nW+ZSHRpPxgirlm1/SFN4gT+UQrCRn5as6v
t3EKmOyL75TqMEhhNiKuEd0sfIkBqgVh9+980hXBGruIANL2syxDeYY=
-----END CERTIFICATE-----
"""
